# Epic 5 Retrospective: Giglet Focus Zones

**Date:** 2026-01-03
**Facilitator:** Bob (Scrum Master)
**Project Lead:** George

---

## Epic Summary

| Metric | Value |
|--------|-------|
| Epic | 5 - Giglet Focus Zones |
| Stories Completed | 8/8 (100%) |
| Unit Tests Added | 49 |
| Code Reviews | 8 APPROVED |
| Production Incidents | 0 |

### Stories Delivered

| Story | Title | Status |
|-------|-------|--------|
| 5.1 | Focus Zones Map Display | Done |
| 5.2 | Zone Scoring Algorithm Backend | Done |
| 5.3 | Meal Time Boost Logic | Done |
| 5.4 | Weather Impact Integration | Done |
| 5.5 | Event Boost Integration | Done |
| 5.6 | Zone Tap Detail View | Done |
| 5.7 | Best Zone Recommendation Banner | Done |
| 5.8 | Zone Score Refresh and Real-Time Updates | Done |

---

## What Went Well

### API Integration Patterns
- OpenWeather API for weather boost - clean integration with 15-min cache
- Ticketmaster API for event boost - 24-hour cache, graceful fallback
- Both APIs handle failures gracefully with neutral scores

### Test-First Approach
- Story 5.3: 21 unit tests for meal time logic
- Story 5.4: 21 unit tests for weather scoring
- Story 5.5: 7 unit tests for event calculations
- Tests caught edge cases in timezone handling and score calculations

### Incremental Delivery
- Built scoring factors one at a time (meal → weather → events)
- Each story added a clear, testable component
- Final integration in Stories 5.6-5.8 went smoothly

### Quick Issue Resolution
- Score mismatch bug (banner showed 36, modal showed 40) identified and fixed same day
- Root cause: banner used cached data, modal fetched fresh API data
- Fix: Use cached zone data consistently across both views

---

## Challenges

### Pull-to-Refresh Limitation
- Original design called for pull-to-refresh on map
- react-native-maps doesn't support ScrollView wrapping
- Adapted to manual refresh button - works well, users understand it

### Water Zone Filtering
- Attempted reverse geocoding to filter zones over water (San Francisco Bay)
- Nominatim API rate limits (1 req/sec) made it too slow for real-time
- Deferred: Added TODO for better solution (Google Maps API, pre-computed data, or tiling service)

---

## Key Learnings

1. **Cache strategy matters** - In-memory Map works for MVP, plan Redis for production
2. **Use cached data consistently** - Avoid mixing fresh API calls with cached data in same view
3. **Timezone handling** - date-fns-tz with IANA timezone strings works reliably
4. **AppState for battery** - Only poll when app is in foreground
5. **React props reactivity** - Banner updates automatically when zones prop changes, no extra work needed

---

## Technical Debt

| Item | Severity | Notes |
|------|----------|-------|
| Duplicate Haversine functions | Low | `getDistanceKm` in RecommendationBanner, `getDistanceMeters` in index.tsx - consolidate to shared utility |
| In-memory caching | Low | Works for MVP, migrate to Redis for production scale |
| Zone water filtering | Low | Deferred due to geocoding API limits |

---

## Future Feature Captured

**Real-Time Zone Alerts & Push Notifications** (added to PRD.md Future Considerations)

When zone conditions change significantly (new hot zone, score spike from event), send push notification to drivers. Includes technical considerations for polling intervals, battery impact, and smart throttling.

---

## Action Items

| Action | Owner | Priority | Status |
|--------|-------|----------|--------|
| None blocking | - | - | Epic shipped clean |

---

## Next Epic Preparation

**Epic 6: Automatic Mileage Tracking** (7 stories)

### Dependencies on Epic 5
- Location permission flow established in Story 5.1
- Background location patterns can inform mileage tracking

### Key Stories
- 6.1: Location permission and tracking enable
- 6.2: Background location tracking
- 6.3: Trip detection and logging
- 6.4-6.7: Dashboard, history, editing, correlation

### No Blockers
- Epic 5 complete and stable
- No critical path items before Epic 6

---

## Retrospective Outcome

**Epic 5 shipped successfully with 100% story completion, 49 unit tests, and zero production incidents. The Focus Zones feature is fully functional with real-time scoring, weather/event boosts, recommendation banner, and auto-refresh. Ready for Epic 6.**
